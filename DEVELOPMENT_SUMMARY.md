# 개발 진행 내역 요약 (v3.0 기능 구현)

이 문서는 PassCheckers AI 여행 준비 시스템의 핵심 추천 기능 구현에 대한 개발 진행 내역을 요약합니다.

## 1. 추천 로직 기반 구현

- **`recommendation_service` 모듈화:** 추천 관련 비즈니스 로직을 `services/recommendation_service.py`로 분리하여 관리합니다.
- **날씨 데이터 연동 (Open-Meteo):**
  - **실시간 예보:** 14일 이내의 여행에 대해 Open-Meteo의 실시간 예보 API를 호출하여 날씨 데이터를 가져옵니다.
  - **과거 데이터 캐싱:** 14일 이후의 여행에 대해서는 `location_weather` DB를 우선 조회합니다. 데이터가 없을 경우, Open-Meteo의 과거 날씨 API를 호출하여 1년치 데이터를 월별로 집계한 후 DB에 저장(캐싱)하여 사용합니다.
- **규칙 기반 엔진 (DB 연동):**
  - 날씨 조건을 정의하는 `weather_rules`와 규칙별 아이템을 저장하는 `rule_items` 테이블을 기반으로, 조회된 날씨 데이터에 따라 동적으로 추천 아이템을 생성하는 로직을 구현했습니다.

## 2. 사용자 맞춤 기능 추가

- **동반자 유형별 추천:**
  - `companion_items` 테이블을 생성하여, 사용자가 선택한 5가지 동반자 유형(혼자, 친구, 연인, 가족, 미성년자 동반)에 따라 맞춤 아이템을 추천 목록에 추가합니다.
- **여행 테마별 추천:**
  - `theme_items` 테이블을 생성했습니다.
  - 날씨 데이터를 기반으로 여행 시점을 '여름'/'겨울'로 판단하고, 사용자가 선택한 여행 테마와 계절에 맞는 아이템을 추천 목록에 추가합니다.
- **통합 추천 이유:**
  - 하나의 아이템이 날씨, 동반자, 테마 등 여러 조건에 의해 중복 추천될 경우, 각각의 추천 이유를 모두 취합하여 `"이유1 / 이유2"` 형식으로 함께 표시하는 로직을 구현했습니다.

## 3. 외부 API 연동 (Amadeus)

- **`amadeus_service` 모듈화:** Amadeus API 관련 로직(인증, API 호출 등)을 `services/amadeus_service.py`로 분리하여 재사용성 및 유지보수성을 높였습니다.
- **보안 및 인증:**
  - API Key/Secret을 `.env` 파일로 분리하고 `config.py`를 통해 로드하여 안전하게 관리합니다.
  - Amadeus API 인증 토큰을 Redis에 캐싱하여 불필요한 인증 요청을 최소화했습니다.
- **항공편 조회 기능:**
  - **`POST /api/flights` 엔드포인트**를 구현했습니다.
  - '항공사 이름' 또는 '항공 편명' 두 가지 방식으로 항공편을 검색하는 기능을 모두 지원합니다.
  - `airlines` 테이블을 참조하여 항공사 이름 <-> IATA 코드를 매핑합니다.
- **항공편 기반 추천:**
  - `flight_condition_items` 테이블을 생성했습니다.
  - 조회된 항공편의 비행 시간을 기준으로 '장거리 비행'(6시간 이상) 여부를 판단하고, 해당 조건에 맞는 아이템(예: 목베개)을 추천 목록에 추가합니다.
- **여행지 안전 정보 연동:**
  - `amadeus_service`에 `get_safety_scores` 함수를 구현하여 Amadeus Safe Place API를 호출하고 목적지의 안전 점수를 가져옵니다.
  - `safety_recommendations` 테이블의 규칙과 API 점수를 비교하여, '도난방지용 가방' 등 안전 관련 아이템을 추천 목록에 추가합니다.

## 4. 프론트엔드 UI 구현

- **항공편 선택 UI:** `SurveyStepper.vue` 컴포넌트에 5번째 단계를 추가하여, 사용자가 항공편을 '편명' 또는 '항공사'로 검색하고 선택할 수 있는 전체 UI 흐름을 구현했습니다.

## 5. 버그 수정 및 안정화

- **순환 참조 오류 해결:** 서비스 모듈(`recommendation_service`, `amadeus_service`)과 `app.py`, 라우트 파일 간의 순환 참조(Circular Import) 문제를 함수 내 지역 import(local import) 방식으로 변경하여 해결했습니다.
- **모듈 경로 오류 해결:** `routes` 폴더 내에서 `services`를 참조할 때 발생했던 `ModuleNotFoundError`를 올바른 상대 경로로 수정하여 해결했습니다.
- **구현 누락 수정:** 리팩토링 과정에서 실수로 삭제되었던 `get_weather_forecast` 등 필수 함수들을 `recommendation_service.py`에 복원하여 서버 실행 오류를 해결했습니다.

## 향후 개발 계획 (v3.1)

다음은 v3.1에서 진행할 기능 개선 및 수정 사항 목록입니다.

### UI/UX 개선
- [ ] **추천 설문 페이지 디자인 개선:** '추천 시작하기' 진입 후 질문 페이지의 전반적인 디자인을 수정합니다.
- [ ] **결과 페이지 레이아웃 변경:**
  - [ ] 물건 추천 목록을 패널 형식으로 변경합니다.
  - [ ] 날씨 요약 그래프에서 실제 여행 기간에 해당하는 월을 하이라이트하여 표시합니다.
- [ ] **여행 추천 첫 페이지 디자인 수정:**
  - [ ] 불필요한 배경 요소를 제거하고 콘텐츠를 패널에 넣어 가독성을 높입니다.
  - [ ] 대표 아이콘 및 '패킹리스트 생성 시작' 버튼의 색상을 조정하여 시인성을 확보합니다.
- [ ] **아이콘 개선:** 기내 반입/위탁 수하물 여부를 한눈에 알 수 있도록 아이콘을 직관적으로 변경합니다.

### 기능 개선 및 수정
- [ ] **매칭 시스템 개선:** 현재 여행지/항공사 이름 매칭 시스템의 정확도 및 사용자 경험을 개선합니다.
- [ ] **추천 결과 상세화:**
  - [ ] 추천된 아이템별로 구체적인 추천 이유를 명확하게 표시합니다.
  - [ ] 각 아이템의 기내/위탁 수하물 규정에 대한 상세 설명(`notes`)을 추가로 제공합니다.
- [ ] **날짜 기반 API 로직 개선:**
  - [ ] 14일 이후의 먼 날짜를 선택했을 경우, 과거 데이터를 기반으로 추천되었음을 안내하는 설명을 결과 페이지에 추가합니다.
  - [ ] 실시간 날씨 예보 데이터를 프론트엔드에서 더욱 효과적으로 가공하여 표시하는 로직을 개선합니다.
- [ ] **네이밍 및 문구 수정:**
  - [ ] 서비스 이름에서 'AI' 문구를 제거합니다.
  - [ ] '여행 추천' 관련 페이지들의 제목을 기능에 맞게(예: '여행 준비물 목록') 수정합니다.
  추가 로그 나오는거 삭제하게

### 기술적 과제
- [ ] **캐싱 전략 논의:** 현재의 '최초 사용 시 캐싱' 전략의 효율성을 팀원들과 논의하고, 필요시 개선합니다.