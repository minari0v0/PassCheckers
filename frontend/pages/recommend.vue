<template>
  <div class="page-container">
    <!-- 1. ì†Œê°œ í™”ë©´ -->
    <div v-if="!isStarted" style="min-height: 100vh;">
      <!-- ìƒë‹¨ ì•ˆë‚´ë¬¸êµ¬ -->
      <section style="text-align:center; margin-top:48px; margin-bottom:32px;">
                  <h1 style="font-size:2.2rem; font-weight:bold;">
                    ì—¬í–‰ ê³„íšì„ ì¤€ë¹„í•˜ëŠ” ë‹¹ì‹ ì„ ìœ„í•œ, <span style="color:var(--main-blue);">ì—¬í–‰ ì¤€ë¹„ ì¶”ì²œ</span>
                  </h1>        <p style="color:#888; margin-top:8px;">
          ì—¬í–‰ì§€, ë‚ ì§œë§Œ ì•Œë ¤ì£¼ì‹œë©´ ë‚ ì”¨ì™€ í˜„ì§€ ìƒí™©ì„ ë¶„ì„í•´ ì™„ë²½í•œ ì—¬í–‰ ì¤€ë¹„ë¬¼ì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.
        </p>
      </section>

      <!-- ë©”ì¸ ì¹´ë“œ: ì£¼ìš” íŠ¹ì§• -->
      <div class="page-section" style="background:#f8fbff; border:1px solid #e3f0fa; margin-bottom: 24px; padding: 48px 32px;">
        <div style="text-align:center; font-weight:600; font-size:1.2rem; margin-bottom:16px; display:flex; align-items:center; justify-content:center; gap:8px;">
          <q-icon name="auto_awesome" color="primary" size="28px" />
          ìŠ¤ë§ˆíŠ¸ ì¶”ì²œ ê¸°ëŠ¥
        </div>
        
        <!-- íŠ¹ì§• ì¹´ë“œë“¤ -->
        <div style="display:flex; gap:24px; justify-content:center; margin-top:32px; flex-wrap:wrap;">
          <!-- ìŠ¤ë§ˆíŠ¸ ì¶”ì²œ ì¹´ë“œ -->
          <q-card flat bordered style="flex:1 1 220px; max-width:320px; min-width:220px; border-radius:16px; padding:32px 20px; text-align:center; display:flex; flex-direction:column; align-items:center; box-shadow: none;">
            <q-icon name="smart_toy" color="primary" size="36px" style="margin-bottom:12px;" />
            <div style="font-weight:600; margin-bottom:8px;">ìŠ¤ë§ˆíŠ¸ ì¶”ì²œ</div>
            <div style="color:#888; font-size:0.98rem;">ì‹¤ì‹œê°„ ë‚ ì”¨, ì—¬í–‰ ê¸°ê°„, í˜„ì§€ íŠ¹ì„±ì„ ì¢…í•© ë¶„ì„í•´ ë‹¹ì‹ ì—ê²Œ ê¼­ í•„ìš”í•œ ì¤€ë¹„ë¬¼ë§Œ ì¶”ì²œí•´ë“œë ¤ìš”.</div>
          </q-card>
          <!-- í•­ê³µ ê·œì • ì•ˆë‚´ ì¹´ë“œ -->
          <q-card flat bordered style="flex:1 1 220px; max-width:320px; min-width:220px; border-radius:16px; padding:32px 20px; text-align:center; display:flex; flex-direction:column; align-items:center; box-shadow: none;">
            <q-icon name="gavel" color="primary" size="36px" style="margin-bottom:12px;" />
            <div style="font-weight:600; margin-bottom:8px;">í•­ê³µ ê·œì • ì•ˆë‚´</div>
            <div style="color:#888; font-size:0.98rem;">í—·ê°ˆë¦¬ëŠ” ê¸°ë‚´ ë°˜ì…, ìœ„íƒ ìˆ˜í•˜ë¬¼ ê·œì •ì„ ê° ë¬¼í’ˆë³„ë¡œ ì•Œê¸° ì‰½ê²Œ í‘œì‹œí•´ ë“œë¦½ë‹ˆë‹¤.</div>
          </q-card>
          <!-- ë¹„í–‰ ì •ë³´ ì—°ë™ ì¹´ë“œ -->
          <q-card flat bordered style="flex:1 1 220px; max-width:320px; min-width:220px; border-radius:16px; padding:32px 20px; text-align:center; display:flex; flex-direction:column; align-items:center; box-shadow: none;">
            <q-icon name="flight_land" color="primary" size="36px" style="margin-bottom:12px;" />
            <div style="font-weight:600; margin-bottom:8px;">ë¹„í–‰ ì •ë³´ ì—°ë™</div>
            <div style="color:#888; font-size:0.98rem;">í•­ê³µí¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ì¥ê±°ë¦¬ ë¹„í–‰ í•„ìˆ˜í’ˆì´ë‚˜ ì‹œì°¨ ì ì‘ ì•„ì´í…œê¹Œì§€ ê¼¼ê¼¼í•˜ê²Œ ì±™ê²¨ë“œë ¤ìš”.</div>
          </q-card>
        </div>
      </div>

      <!-- CTA ì¹´ë“œ -->
      <div class="page-section" style="background:#ffffff; border:1px solid #e0e0e0; padding: 24px 32px;">
        <h2 style="font-size: 1.8rem; font-weight: 700; color: #333; text-align: center; margin-bottom: 8px;">ë‚˜ë§Œì˜ íŒ¨í‚¹ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°</h2>
        <p style="color:#888; text-align: center; margin-bottom: 24px;">
          ê°„ë‹¨í•œ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ë§Œì˜ íŠ¹ë³„í•œ ì—¬í–‰ ì¤€ë¹„ë¥¼ ì‹œì‘í•˜ì„¸ìš”.
        </p>
        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 24px; color: #546e7a;">
            <div style="display: flex; align-items: center; gap: 0.5rem;"><q-icon name="schedule" /><span>ì†Œìš”ì‹œê°„: ì•½ 30ì´ˆ</span></div>
            <div style="width: 4px; height: 4px; background: #b0bec5; border-radius: 50%;"></div>
            <div style="display: flex; align-items: center; gap: 0.5rem;"><q-icon name="grade" /><span>ë¬´ë£Œ ì„œë¹„ìŠ¤</span></div>
        </div>
        <div style="text-align:center;">
          <q-btn 
            color="primary" 
            label="íŒ¨í‚¹ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹œì‘" 
            unelevated 
            @click="startSurvey"
            style="border-radius: 12px; padding: 12px 24px; font-size: 1.1rem;"
            class="packing-start-btn"
            no-caps
            no-ripple
          />
        </div>
      </div>
    </div>

    <!-- 2. ì„¤ë¬¸ì¡°ì‚¬ ë° ê²°ê³¼ í™”ë©´ -->
    <div v-else class="survey-container-wide">
      <!-- Survey Header -->
      <section style="text-align:center; margin-top:48px; margin-bottom:32px;">
        <h1 style="font-size:2.2rem; font-weight:bold;">
          <span style="color:var(--main-blue);">ë‚˜ë§Œì˜</span> ì—¬í–‰ ì¤€ë¹„ë¬¼ ì°¾ê¸°
        </h1>
        <p style="color:#888; margin-top:8px;">
          ëª‡ ê°€ì§€ ì§ˆë¬¸ì— ë‹µë³€í•˜ê³  ì™„ë²½í•œ íŒ¨í‚¹ë¦¬ìŠ¤íŠ¸ë¥¼ ë°›ì•„ë³´ì„¸ìš”.
        </p>
      </section>

      <SurveyStepper v-if="!showResults" @survey-complete="handleSurveyComplete" />

      <!-- ê²°ê³¼ í‘œì‹œ -->
      <div v-else class="results-wrapper">
        <!-- í—¤ë”ì™€ í•­ê³µí¸ ì •ë³´ë¥¼ ê°™ì€ í–‰ì— ë°°ì¹˜ -->
        <div class="form-header-with-flight">
          <!-- ì™¼ìª½: ì œëª©ê³¼ ë²„íŠ¼ë“¤ -->
          <div class="form-header-left">
            <h2 class="form-title">
              ë‚˜ë§Œì˜ íŒ¨í‚¹ë¦¬ìŠ¤íŠ¸
              <span v-if="finalSelections && finalSelections.destination" class="destination-text">
                - {{ finalSelections.destination }}
              </span>
            </h2>
            <div class="form-buttons">
              <q-btn 
                v-if="locationId"
                outline 
                color="primary" 
                label="ì—¬í–‰ì§€ ê´€ë ¨ ì •ë³´" 
                @click="showInfoModal = true"
                class="q-mr-sm custom-button"
                no-caps
                no-ripple
              />
              <q-btn 
                v-if="locationId"
                outline 
                color="info"
                label="ì—¬í–‰ì ì†Œí†µ ê³µê°„"
                to="/community"
                class="q-mr-sm custom-button"
                no-caps
                no-ripple
              />
              <q-btn 
                v-if="packingList.length > 0"
                outline 
                color="secondary" 
                label="ìˆ˜í•˜ë¬¼ ëª©ë¡ ì¶”ê°€" 
                @click="openAddToListModal"
                class="custom-button"
                no-caps
                no-ripple
              />
            </div>
          </div>
          
          <!-- ì˜¤ë¥¸ìª½: í•­ê³µí¸ ì •ë³´ ì¹´ë“œë“¤ -->
          <div v-if="finalSelections && finalSelections.flight" class="flight-info-cards">
            <!-- í•­ê³µí¸ ì •ë³´ ì¹´ë“œ -->
            <q-card flat bordered class="flight-info-card">
              <q-card-section class="q-pa-sm">
                <div class="flight-info-content">
                  <q-icon name="flight_takeoff" color="blue-grey-5" size="md" class="q-mr-sm"/>
                  <div>
                    <div class="text-weight-bold text-caption">{{ finalSelections.flight.carrierCode }}{{ finalSelections.flight.flightNumber }}</div>
                    <div class="text-caption text-grey-7">í•­ê³µí¸</div>
                  </div>
                </div>
              </q-card-section>
            </q-card>
            
            <!-- ê¸°ì¢… ì¹´ë“œ -->
            <q-card flat bordered class="flight-info-card">
              <q-card-section class="q-pa-sm">
                <div class="flight-info-content">
                  <q-icon name="airplanemode_active" color="blue-grey-5" size="md" class="q-mr-sm"/>
                  <div>
                    <div class="text-weight-bold text-caption">{{ finalSelections.flight.aircraft }}</div>
                    <div class="text-caption text-grey-7">ê¸°ì¢…</div>
                  </div>
                </div>
              </q-card-section>
            </q-card>
            
            <!-- í„°ë¯¸ë„ ì¹´ë“œ -->
            <q-card flat bordered class="flight-info-card">
              <q-card-section class="q-pa-sm">
                <div class="flight-info-content">
                  <q-icon name="schedule" color="blue-grey-5" size="md" class="q-mr-sm"/>
                  <div>
                    <div class="text-weight-bold text-caption">T{{ finalSelections.flight.departureTerminal }}</div>
                    <div class="text-caption text-grey-7">í„°ë¯¸ë„</div>
                  </div>
                </div>
              </q-card-section>
            </q-card>
            
            <!-- ë¬´ë£Œ ìˆ˜í•˜ë¬¼ ì¹´ë“œ -->
            <q-card flat bordered class="flight-info-card">
              <q-card-section class="q-pa-sm">
                <div class="flight-info-content">
                  <q-icon name="luggage" color="blue-grey-5" size="md" class="q-mr-sm"/>
                  <div>
                    <div class="text-weight-bold text-caption">{{ finalSelections.flight.baggage.free }}</div>
                    <div class="text-caption text-grey-7">ë¬´ë£Œìˆ˜í•˜ë¬¼</div>
                  </div>
                </div>
              </q-card-section>
            </q-card>
          </div>
        </div>

        <q-banner v-if="isHistorical" inline-actions rounded class="bg-blue-1 text-primary q-mb-md">
          <template v-slot:avatar>
            <q-icon name="info" />
          </template>
          ì¼ê¸° ì˜ˆë³´ë¥¼ í™•ì¸í•˜ê¸° ì–´ë ¤ìš´ ë¨¼ ë‚ ì§œì´ë¯€ë¡œ, ê³¼ê±° ë‚ ì”¨ í†µê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œí•´ ë“œë ¸ì–´ìš”.
        </q-banner>

        <q-card class="output-card" flat style="padding: 1.5rem; background-color: #f8fbff; border: 1px solid #e3f0fa;">
          <div v-if="isLoading" class="loading-state">
            <q-spinner-gears size="xl" color="primary" />
            <p class="q-mt-md text-subtitle1">ê²°ê³¼ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>

          <div v-else class="result-grid">
            <!-- Left Column: Recommendation List -->
            <div class="recommendation-list">
              <q-card flat bordered class="q-mb-lg" v-for="group in packingList" :key="group.group_name">
                <q-card-section class="card-header-light-blue">
                  <div class="text-h6">{{ getGroupTitle(group) }}</div>
                </q-card-section>
                <q-separator />
                <q-list separator class="animated-list">
                    <q-item v-for="item in (expandedGroups[group.group_name] ? group.items : group.items.slice(0, 3))" :key="item.name" class="q-py-md list-item-animated">
                        <q-item-section>
                            <div class="row items-baseline no-wrap">
                                <span class="text-subtitle1 text-weight-medium q-mr-sm">{{ item.name }}</span>
                                <span class="text-caption text-grey-7" v-if="item.reason">{{ item.reason }}</span>
                            </div>
                        </q-item-section>

                        <q-item-section side>
                            <div class="row items-center q-gutter-x-sm">
                                <q-icon v-if="item.regulation.includes('ê¸°ë‚´')" name="backpack" color="blue">
                                    <q-tooltip>ê¸°ë‚´ ë°˜ì…</q-tooltip>
                                </q-icon>
                                <q-icon v-if="item.regulation.includes('ìœ„íƒ')" name="inventory_2" color="deep-orange">
                                    <q-tooltip>ìœ„íƒ ìˆ˜í•˜ë¬¼</q-tooltip>
                                </q-icon>
                                <q-icon name="info_outline" color="grey-6" v-if="item.notes && item.notes.trim() !== '' && item.notes.trim() !== 'ì œí•œ ì—†ìŒ'">
                                    <q-tooltip max-width="250px" style="font-size: 12px;">
                                        {{ item.notes }}
                                    </q-tooltip>
                                </q-icon>
                            </div>
                        </q-item-section>
                    </q-item>
                </q-list>
                <div v-if="group.items.length > 3" class="card-footer-custom" @click="toggleGroup(group.group_name)">
                  <div class="footer-content">
                    <span class="footer-text">{{ expandedGroups[group.group_name] ? 'ê°„ëµíˆ ë³´ê¸°' : 'ë”ë³´ê¸°' }}</span>
                    <q-icon :name="expandedGroups[group.group_name] ? 'expand_less' : 'expand_more'" class="footer-icon" />
                  </div>
                </div>
              </q-card>
            </div>
            
            <!-- Right Column: Weather Info -->
            <div class="weather-column">

              <!-- Real-time Forecast Display -->
              <div class="forecast-container q-mb-lg" v-if="forecastData">
                <q-card flat bordered>
                  <q-card-section class="card-header-light-blue">
                    <div class="text-h6">ì£¼ê°„ ì˜ˆë³´ - {{ finalSelections.destination }}</div>
                  </q-card-section>
                  <q-separator />
                  <div class="forecast-grid-horizontal q-pa-md">
                    <div v-for="day in tripForecast" :key="day.time" class="forecast-day-col">
                        <div class="text-weight-medium">{{ new Date(day.time).toLocaleDateString('ko-KR', { weekday: 'short' }) }}</div>
                        <div class="text-caption text-grey">{{ new Date(day.time).toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' }) }}</div>
                        <div class="text-h5 q-my-sm">{{ day.weather_icon }}</div>
                        <div class="text-caption text-grey-7" v-if="day.precipitation_probability_mean > 0">({{ day.precipitation_probability_mean }}%)</div>
                        <div class="text-weight-bold q-mt-xs">
                            <span class="text-red">{{ Math.round(day.temperature_2m_max) }}Â°</span> / <span class="text-blue">{{ Math.round(day.temperature_2m_min) }}Â°</span>
                        </div>
                    </div>
                  </div>
                </q-card>
              </div>

              <!-- Historical Weather Chart -->
              <div class="weather-chart-container">
                <q-card flat bordered v-if="historicalWeather">
                  <q-card-section class="card-header-light-blue">
                    <div class="text-h6">ì›”ë³„ ë‚ ì”¨ ìš”ì•½ - {{ finalSelections.destination }}</div>
                  </q-card-section>
                  <q-separator />
                  <q-card-section style="height: 400px;">
                    <WeatherChart :weather-data="historicalWeather" :travel-dates="finalSelections.dates" />
                  </q-card-section>
                </q-card>
              </div>
            </div>
          </div>
        </q-card>
      </div>
    </div>

    <!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <Teleport to="body">
      <div v-if="showInfoModal" class="modal-overlay" @click="showInfoModal = false">
        <div class="modal-content" @click.stop>
          <button class="modal-close" @click="showInfoModal = false">&times;</button>
          <InfoDetailComponent v-if="locationId" :location-id="locationId" @close="showInfoModal = false" />
        </div>
      </div>
          </Teleport>
    
      <!-- "ë‚´ ëª©ë¡ì— ì¶”ê°€" ëª¨ë‹¬ -->
      <q-dialog v-model="showAddToListModal">
        <q-card class="modal-card-custom" style="width: 900px; max-width: 90vw; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
          <q-card-section class="modal-header-custom">
            <div class="modal-title">ë‚´ ì§ ëª©ë¡ì— ì¶”ê°€</div>
            <q-space />
            <q-btn icon="close" flat round dense v-close-popup class="modal-close-btn" />
          </q-card-section>
          
          <!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…ì¸  ì˜ì—­ -->
          <div class="modal-content-scrollable">

          <!-- ë¶„ì„ ê¸°ë¡ ì„ íƒ -->
          <q-card-section v-if="analysisHistory.length > 0">
            <div class="text-subtitle1 q-mb-sm">ì¶”ê°€í•  ëª©ë¡ ì„ íƒ</div>
            <q-list bordered separator style="border-radius: 8px;">
              <q-item v-for="item in analysisHistory" :key="item.id" tag="label" v-ripple>
                <q-item-section avatar top>
                  <q-radio v-model="selectedAnalysisId" :val="item.id" />
                </q-item-section>
                <q-item-section>
                  <q-item-label>{{ item.destination || 'ì•Œ ìˆ˜ ì—†ëŠ” ëª©ì ì§€' }}</q-item-label>
                  <q-item-label caption>{{ item.analysis_date }} ë¶„ì„</q-item-label>
                </q-item-section>
                <q-item-section side top>
                  <q-badge outline color="primary" :label="`${item.total_items}ê°œ ë¬¼í’ˆ`" />
                </q-item-section>
              </q-item>
            </q-list>
          </q-card-section>

          <!-- ì•„ì´í…œ ëª©ë¡ (ì¢Œìš° ë¶„í• ) -->
          <q-card-section v-if="selectedAnalysisId" class="q-pt-none">
            <div class="row q-col-gutter-md">
              <!-- ì™¼ìª½: ì´ë¯¸ ìˆëŠ” ì§ -->
              <div class="col-6">
                <div class="text-subtitle1 q-mb-sm">ëª©ë¡ì— ì´ë¯¸ ìˆëŠ” ì§ ({{ existingItems.length }}ê°œ)</div>
                <q-card flat bordered>
                  <q-list dense separator style="max-height: 300px; overflow-y: auto;">
                    <q-inner-loading :showing="isFetchingDetails">
                      <q-spinner-dots size="40px" color="primary" />
                    </q-inner-loading>
                    <q-item v-if="!isFetchingDetails && existingItems.length === 0">
                      <q-item-section class="text-grey text-center">
                        (ë¹„ì–´ ìˆìŒ)
                      </q-item-section>
                    </q-item>
                    <q-item v-for="item in existingItems" :key="item.id">
                      <q-item-section>
                        <q-item-label>{{ item.item_name_ko }}</q-item-label>
                      </q-item-section>
                    </q-item>
                  </q-list>
                </q-card>
              </div>
              <!-- ì˜¤ë¥¸ìª½: ì¶”ê°€í•  ì¶”ì²œ ì•„ì´í…œ -->
              <div class="col-6">
                <div class="text-subtitle1 q-mb-sm">ì¶”ê°€í•  ì¶”ì²œ ì•„ì´í…œ</div>
                <q-card flat bordered>
                  <q-list dense style="max-height: 300px; overflow-y: auto;">
                    <q-item tag="label" v-ripple>
                      <q-item-section side>
                        <q-checkbox :model-value="areAllSelected" @update:model-value="toggleSelectAll" />
                      </q-item-section>
                      <q-item-section>
                        <q-item-label class="text-weight-bold">ì „ì²´ ì„ íƒ/í•´ì œ</q-item-label>
                      </q-item-section>
                    </q-item>
                    <q-separator />
                    <q-expansion-item
                      v-for="group in packingList"
                      :key="group.group_name"
                      :label="getGroupTitle(group)"
                      header-class="bg-grey-1"
                    >
                      <q-list dense separator>
                        <q-item v-for="item in group.items" :key="item.name" tag="label" v-ripple>
                          <q-item-section side>
                            <q-checkbox v-model="itemsToAdd" :val="item.name" />
                          </q-item-section>
                          <q-item-section>
                            <q-item-label>{{ item.name }}</q-item-label>
                          </q-item-section>
                        </q-item>
                      </q-list>
                    </q-expansion-item>
                  </q-list>
                </q-card>
              </div>
            </div>
          </q-card-section>

          <!-- ë¶„ì„ ê¸°ë¡ì´ ì—†ì„ ë•Œ -->
          <q-card-section v-else-if="!analysisHistory.length" class="text-center q-py-xl">
            <q-icon name="info_outline" size="xl" color="grey-5" />
            <p class="q-mt-md text-h6">ì €ì¥í•  ë¶„ì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p class="text-grey-7">ë¨¼ì € 'ìˆ˜í•˜ë¬¼ ë¶„ë¥˜' í˜ì´ì§€ì—ì„œ ë‚´ ì§ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.</p>
            <q-btn to="/classification" unelevated color="primary" label="ìˆ˜í•˜ë¬¼ ë¶„ë¥˜í•˜ëŸ¬ ê°€ê¸°" class="q-mt-sm" />
          </q-card-section>

          </div>
          
          <!-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ (ìŠ¤í¬ë¡¤ë˜ì§€ ì•ŠìŒ) -->
          <q-separator />
          <q-card-actions align="right" class="q-pa-md bg-grey-1 modal-footer-custom">
            <q-btn flat label="ì·¨ì†Œ" color="primary" v-close-popup class="modal-bottom-btn" />
            <q-btn v-if="analysisHistory.length > 0" unelevated label="ì„ íƒí•œ ëª©ë¡ì— ì¶”ê°€" color="primary" @click="saveItemsToList" :disable="!selectedAnalysisId" class="modal-bottom-btn" />
          </q-card-actions>
        </q-card>
      </q-dialog>
        </div></template>

<script setup>
import { ref, computed, watch } from 'vue';
import { useQuasar } from 'quasar';
import SurveyStepper from '~/components/recommend/SurveyStepper.vue';
import WeatherChart from '~/components/recommend/WeatherChart.vue';
import InfoDetailComponent from '~/components/info/DetailComponent.vue';
import { useApiUrl } from '~/composables/useApiUrl';
import { useAuth } from '~/composables/useAuth';

useHead({
  title: 'ì—¬í–‰ ì¶”ì²œ | PassChekcers'
})

definePageMeta({ middleware: 'auth' });

// --- ì»´í¬ì €ë¸” ---
const { getApiUrl } = useApiUrl();
const { user } = useAuth();
const $q = useQuasar();

// --- ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ---
const isStarted = ref(false);
const showResults = ref(false);
const isLoading = ref(false);
const packingList = ref([]);
const finalSelections = ref(null);
const historicalWeather = ref(null);
const forecastData = ref(null);
const isHistorical = ref(false);
const locationId = ref(null);
const expandedGroups = ref({});

const communityLink = computed(() => {
  if (finalSelections.value && finalSelections.value.destination) {
    return `/community?search=${encodeURIComponent(finalSelections.value.destination)}`;
  }
  return '/community';
});

// --- "ì •ë³´" ëª¨ë‹¬ ìƒíƒœ ---
const showInfoModal = ref(false);

// --- "ëª©ë¡ì— ì¶”ê°€" ëª¨ë‹¬ ìƒíƒœ ---
const showAddToListModal = ref(false);
const analysisHistory = ref([]);
const selectedAnalysisId = ref(null);
const itemsToAdd = ref([]);
const existingItems = ref([]);
const isFetchingDetails = ref(false);


// --- ê°ì‹œì(Watcher) ---
watch(selectedAnalysisId, async (newId) => {
  if (newId) {
    isFetchingDetails.value = true;
    existingItems.value = [];
    try {
      const response = await fetch(getApiUrl(`/api/analysis/detail/${newId}`));
      if (!response.ok) throw new Error('ë¶„ì„ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      const data = await response.json();
      existingItems.value = data.items || [];
    } catch (error) {
      $q.notify({ type: 'negative', message: error.message });
    } finally {
      isFetchingDetails.value = false;
    }
  } else {
    existingItems.value = [];
  }
});

// --- "ì „ì²´ ì„ íƒ" ê³„ì‚°ëœ ì†ì„± ---
const allRecommendedItems = computed(() => 
  packingList.value.flatMap(group => group.items.map(item => item.name))
);

const areAllSelected = computed(() => 
  allRecommendedItems.value.length > 0 && 
  itemsToAdd.value.length === allRecommendedItems.value.length
);

const toggleSelectAll = (newValue) => {
  if (newValue) {
    itemsToAdd.value = [...allRecommendedItems.value];
  } else {
    itemsToAdd.value = [];
  }
};


// --- í•¨ìˆ˜ ---

const openAddToListModal = async () => {
  if (!user.value) {
    $q.notify({ type: 'negative', message: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' });
    return;
  }
  try {
    const response = await fetch(getApiUrl(`/api/analysis/history/${user.value.id}`));
    if (!response.ok) throw new Error('ë¶„ì„ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    const data = await response.json();
    analysisHistory.value = data.results || [];
    // const allItemNames = packingList.value.flatMap(group => group.items.map(item => item.name));
    itemsToAdd.value = []; // ê¸°ë³¸ì ìœ¼ë¡œ ì„ íƒ í•´ì œ
    selectedAnalysisId.value = null;
    existingItems.value = [];
    showAddToListModal.value = true;
  } catch (error) {
    $q.notify({ type: 'negative', message: error.message });
  }
};

const saveItemsToList = async () => {
  if (!selectedAnalysisId.value) {
    $q.notify({ type: 'warning', message: 'ì•„ì´í…œì„ ì¶”ê°€í•  ë¶„ì„ ê¸°ë¡ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' });
    return;
  }
  if (itemsToAdd.value.length === 0) {
    $q.notify({ type: 'warning', message: 'ì¶”ê°€í•  ì•„ì´í…œì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.' });
    return;
  }
  try {
    const postResponse = await fetch(getApiUrl(`/api/analysis/${selectedAnalysisId.value}/add-items`), {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ item_names: itemsToAdd.value })
    });
    if (!postResponse.ok) throw new Error('ì•„ì´í…œ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    const result = await postResponse.json();
    $q.notify({ type: 'positive', message: result.message || 'ì•„ì´í…œì´ ë‚´ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.' });
    
    const historyItem = analysisHistory.value.find(h => h.id === selectedAnalysisId.value);
    if (historyItem) {
        historyItem.total_items += itemsToAdd.value.length;
    }

    // ìƒíƒœ ì´ˆê¸°í™”ë¡œ í´ë” ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°
    selectedAnalysisId.value = null;
    itemsToAdd.value = [];

  } catch (error) {
    $q.notify({ type: 'negative', message: error.message });
  }
};

const toggleGroup = (groupName) => {
  expandedGroups.value[groupName] = !expandedGroups.value[groupName];
};

const formatFullDateTime = (isoString) => {
  if (!isoString) return '';
  return new Date(isoString).toLocaleString('ko-KR', {
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    hour12: false
  });
};

const getGroupTitle = (group) => {
  const groupName = group.group_name;
  const selections = finalSelections.value;
  if (!selections) return groupName;
  switch (groupName) {
    case 'ë‚ ì”¨':
      if (isHistorical.value) {
        if (historicalWeather.value && finalSelections.value?.dates?.from) {
          const travelMonth = new Date(finalSelections.value.dates.from).getMonth() + 1;
          const monthData = historicalWeather.value.find(m => m.month === travelMonth);
          if (monthData) {
            const maxTemp = parseFloat(monthData.avg_max_temp);
            const minTemp = parseFloat(monthData.avg_min_temp);
            if (!isNaN(maxTemp) && !isNaN(minTemp)) {
              const avgTemp = Math.round((maxTemp + minTemp) / 2);
              const precip = Math.round(parseFloat(monthData.monthly_precipitation_mm));
              return `ì›”ë³„ í‰ê·  ${avgTemp}Â°C, ê°•ìˆ˜ëŸ‰ ${precip}mm`;
            }
          }
        }
        return 'ì›”ë³„ ë‚ ì”¨ ìš”ì•½';
      } else if (tripForecast.value && tripForecast.value.length > 0) {
        const totalDays = tripForecast.value.length;
        const avgTemp = Math.round(
          tripForecast.value.reduce((sum, day) => sum + (day.temperature_2m_max + day.temperature_2m_min) / 2, 0) / totalDays
        );
        const avgPrecip = Math.round(
          tripForecast.value.reduce((sum, day) => sum + day.precipitation_probability_mean, 0) / totalDays
        );
        return `í‰ê·  ${avgTemp}Â°C, ê°•ìˆ˜í™•ë¥  ${avgPrecip}%`;
      }
      return 'ë‚ ì”¨ ê¸°ë°˜ ì¶”ì²œ';
    case 'ë™ë°˜ì':
      if (selections.companion) {
        const companionMap = {
          solo: 'ë‚˜í™€ë¡œ ë– ë‚˜ëŠ” ì—¬í–‰',
          couple: 'ì—°ì¸ê³¼ í•¨ê»˜í•˜ëŠ” ì—¬í–‰',
          family: 'ê°€ì¡±ê³¼ í•¨ê»˜í•˜ëŠ” ì—¬í–‰',
          friends: 'ì¹œêµ¬ì™€ í•¨ê»˜í•˜ëŠ” ì—¬í–‰',
          with_children: 'ì•„ì´ì™€ í•¨ê»˜í•˜ëŠ” ì—¬í–‰'
        };
        return companionMap[selections.companion] || 'ë™ë°˜ì ë§ì¶¤ ì¶”ì²œ';
      }
      return 'ë™ë°˜ì ë§ì¶¤ ì¶”ì²œ';
    case 'í…Œë§ˆ':
      if (selections.themes && selections.themes.length > 0) {
        const themeNameMap = {
          healing: 'íë§/íœ´ì–‘',
          food: 'ë¯¸ì‹',
          shopping: 'ì‡¼í•‘',
          activity: 'ì•¡í‹°ë¹„í‹°',
          culture: 'ë¬¸í™”/ì—­ì‚¬'
        };
        const mappedNames = selections.themes.map(t => themeNameMap[t]).filter(Boolean);
        if (mappedNames.length > 0) {
          return `${mappedNames.join(' & ')}ë¥¼ ì¦ê¸°ê¸° ìœ„í•œ ì¤€ë¹„ë¬¼`;
        }
      }
      return 'í…Œë§ˆ ë§ì¶¤ ì¶”ì²œ';
    case 'í•­ê³µí¸':
      return 'ì¥ê±°ë¦¬ ë¹„í–‰ì„ ìœ„í•œ ì¤€ë¹„';
    default:
      return groupName;
  }
};

const tripForecast = computed(() => {
  if (!forecastData.value || !finalSelections.value || !finalSelections.value.dates) {
    return [];
  }
  const startDate = new Date(finalSelections.value.dates.from);
  const endDate = new Date(finalSelections.value.dates.to);
  startDate.setHours(0, 0, 0, 0);
  endDate.setHours(0, 0, 0, 0);
  return forecastData.value.filter(day => {
    const dayDate = new Date(day.time);
    dayDate.setHours(0, 0, 0, 0);
    return dayDate >= startDate && dayDate <= endDate;
  });
});

const mapWeatherCodeToIcon = (code) => {
  const iconMap = { 0: 'â˜€ï¸', 1: 'ğŸŒ¤ï¸', 2: 'ğŸŒ¥ï¸', 3: 'â˜ï¸', 45: 'ğŸŒ«ï¸', 48: 'ğŸŒ«ï¸', 51: 'ğŸ’§', 53: 'ğŸ’§', 55: 'ğŸ’§', 61: 'ğŸŒ§ï¸', 63: 'ğŸŒ§ï¸', 65: 'ğŸŒ§ï¸', 71: 'â„ï¸', 73: 'â„ï¸', 75: 'â„ï¸', 77: 'â„ï¸', 80: 'ğŸŒ¦ï¸', 81: 'ğŸŒ¦ï¸', 82: 'â›ˆï¸', 85: 'ğŸŒ¨ï¸', 86: 'ğŸŒ¨ï¸', 95: 'âš¡ï¸' };
  return iconMap[code] || 'â”';
};

const startSurvey = () => { isStarted.value = true; };

const goBackToSurvey = () => {
  showResults.value = false;
  packingList.value = [];
  finalSelections.value = null;
  historicalWeather.value = null;
  isHistorical.value = false;
  forecastData.value = null;
  locationId.value = null;
  showInfoModal.value = false;
};

const handleSurveyComplete = async (surveyData) => {
  finalSelections.value = surveyData;
  showResults.value = true;
  isLoading.value = true;
  packingList.value = [];
  historicalWeather.value = null;
  isHistorical.value = false;
  forecastData.value = null;
  const today = new Date();
  const startDate = new Date(surveyData.dates.from);
  const diffTime = startDate.getTime() - today.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  if (diffDays > 14) {
    isHistorical.value = true;
  }
  try {
    const recommendationEndpoint = getApiUrl('/api/packing-recommendation');
    const response = await fetch(recommendationEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(surveyData),
    });
    if (!response.ok) {
      throw new Error('Network response was not ok for packing list');
    }
    const data = await response.json();
    packingList.value = data.packing_list;
    locationId.value = data.location_id || null;
    
    // ì‹¤ì‹œê°„ ì˜ˆë³´ ë°ì´í„° ì²˜ë¦¬
    if (data.forecast_data) {
      const processedForecast = data.forecast_data.map(day => ({
        ...day,
        weather_icon: mapWeatherCodeToIcon(day.weathercode)
      }));
      forecastData.value = processedForecast;
    }
    
    // ì›”ë³„ ê³¼ê±° ë‚ ì”¨ ë°ì´í„° ì²˜ë¦¬ (API ì‘ë‹µì—ì„œ ì§ì ‘ ë°›ìŒ)
    if (data.historical_weather) {
      historicalWeather.value = data.historical_weather;
      console.log('ì›”ë³„ ê³¼ê±° ë‚ ì”¨ ë°ì´í„° ìˆ˜ì‹ :', data.historical_weather);
    } else if (data.location_id) {
      // ë°±ì—…: ë³„ë„ API í˜¸ì¶œ (ê¸°ì¡´ ë°©ì‹)
      const weatherEndpoint = getApiUrl(`/api/locations/${data.location_id}/weather/historical`);
      const weatherResponse = await fetch(weatherEndpoint);
      if (weatherResponse.ok) {
        historicalWeather.value = await weatherResponse.json();
        console.log('ë³„ë„ APIë¡œ ì›”ë³„ ê³¼ê±° ë‚ ì”¨ ë°ì´í„° ìˆ˜ì‹ :', historicalWeather.value);
      }
    }
  } catch (error) {
    console.error('Error fetching packing list:', error);
    packingList.value = [
        { group_name: 'ì˜¤ë¥˜', items: [{ name: 'API ë¡œë”© ì‹¤íŒ¨', reason: 'ì¶”ì²œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', regulation: 'checked', icon: 'warning' }] },
    ];
  } finally {
    isLoading.value = false;
  }
};
</script>
<style scoped>
/* í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° */
@import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;800&display=swap');

.page-section { 
  border-radius: 20px; 
  padding: 32px; 
  margin: 0 auto; 
  max-width: 1200px; 
  width: 100%; 
  box-sizing: border-box; 
}

/* --- 2. ì„¤ë¬¸ ë° ê²°ê³¼ ë·° ìŠ¤íƒ€ì¼ --- */
.survey-container-wide {
  max-width: 1600px;
  margin: 0 auto;
  padding: 2rem;
}

.results-wrapper {
  margin-top: 2rem;
  padding: 0 2rem; /* ì¢Œìš° ì—¬ë°± ì¶”ê°€ */
}

.form-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

/* ìƒˆë¡œìš´ í—¤ë” ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
.form-header-with-flight {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  gap: 2rem;
}

.form-header-left {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.form-buttons {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.flight-info-cards {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.flight-info-card {
  min-width: 120px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.flight-info-content {
  display: flex;
  align-items: center;
  text-align: center;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
  .form-header-with-flight {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .flight-info-cards {
    width: 100%;
    justify-content: space-between;
  }
  
  .flight-info-card {
    flex: 1;
    min-width: 80px;
  }
  
  .form-buttons {
    flex-wrap: wrap;
  }
}

.form-title {
  font-size: 2rem;
  font-weight: 700;
  color: #34495e;
}

.destination-text {
  color: var(--q-primary);
  font-weight: 600;
}

/* ì»¤ìŠ¤í…€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.custom-button {
  border-radius: 4px !important;
  transition: none !important;
  transform: none !important;
  box-shadow: none !important;
  border: 2px solid !important;
}

.custom-button::before,
.custom-button::after {
  display: none !important;
}

.custom-button:hover {
  transform: none !important;
  box-shadow: none !important;
}

.custom-button:active {
  transform: none !important;
}

/* ì¹´ë“œ í—¤ë” í•˜ëŠ˜ìƒ‰ ì—°í•˜ê²Œ */
.card-header-light-blue {
  background-color: #e3f2fd !important;
  border-bottom: 1px solid #bbdefb;
}

/* ì¹´ë“œ í‘¸í„° ìŠ¤íƒ€ì¼ */
.card-footer-custom {
  background-color: #f5f5f5 !important;
  border-top: 1px solid rgba(0, 0, 0, 0.12);
  padding: 12px 16px !important;
  cursor: pointer;
  transition: background-color 0.2s ease;
  user-select: none;
}

.card-footer-custom:hover {
  background-color: rgba(33, 150, 243, 0.1) !important;
  box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
}

.footer-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.footer-text {
  color: #2196f3;
  font-weight: 500;
  font-size: 0.9rem;
}

.footer-icon {
  color: #2196f3;
  font-size: 1.2rem;
}

/* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
.animated-list {
  overflow: hidden;
  transition: max-height 0.3s ease-in-out;
}

.list-item-animated {
  transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
}

.list-item-animated-enter-active,
.list-item-animated-leave-active {
  transition: all 0.3s ease;
}

.list-item-animated-enter-from {
  opacity: 0;
  transform: translateY(-10px);
}

.list-item-animated-leave-to {
  opacity: 0;
  transform: translateY(-10px);
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal-card-custom {
  border-radius: 12px !important;
}

.modal-header-custom {
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  border-bottom: 2px solid #90caf9;
  padding: 20px 24px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
}

.modal-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1976d2;
  flex: 1;
}

.modal-close-btn {
  transition: none !important;
  transform: none !important;
  box-shadow: none !important;
  background: transparent !important;
  border-radius: 50% !important;
  width: 32px !important;
  height: 32px !important;
  min-height: 32px !important;
  margin-left: auto !important;
  flex-shrink: 0 !important;
}

.modal-close-btn::before,
.modal-close-btn::after {
  display: none !important;
}

.modal-close-btn:hover {
  transform: none !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  background: transparent !important;
}

.modal-bottom-btn {
  border-radius: 6px !important;
  transition: none !important;
  transform: none !important;
  box-shadow: none !important;
  border: 2px solid !important;
}

.modal-bottom-btn::before,
.modal-bottom-btn::after {
  display: none !important;
}

.modal-bottom-btn:hover {
  transform: none !important;
  box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3) !important;
}

.modal-bottom-btn:active {
  transform: none !important;
}

/* ëª¨ë‹¬ ìŠ¤í¬ë¡¤ ì˜ì—­ ì²˜ë¦¬ */
.modal-content-scrollable {
  overflow-y: auto;
  flex: 1;
  max-height: calc(90vh - 120px); /* í—¤ë”ì™€ í‘¸í„° ë†’ì´ ì œì™¸ */
}

.modal-content-scrollable::-webkit-scrollbar {
  width: 8px;
}

.modal-content-scrollable::-webkit-scrollbar-track {
  background: transparent;
}

.modal-content-scrollable::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 4px;
}

.modal-content-scrollable::-webkit-scrollbar-thumb:hover {
  background: #999;
}

/* ëª¨ë‹¬ í‘¸í„° */
.modal-footer-custom {
  border-radius: 0 0 12px 12px !important;
  flex-shrink: 0;
}

/* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
.modal-card-custom .q-list {
  border-radius: 8px !important;
}

.modal-card-custom .q-card {
  border-radius: 8px !important;
}

.output-card {
  min-height: 500px;
}

.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  min-height: 500px;
  text-align: center;
  color: #95a5a6;
}

.result-state {
  padding: 1rem;
}

.result-grid {
  display: grid;
  grid-template-columns: 1.5fr 1fr;
  gap: 2.5rem;
}


.weather-column {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.forecast-grid-horizontal {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.forecast-day-col {
  flex-grow: 0; /* ë§ˆì§€ë§‰ ì¤„ì—ì„œ ì•„ì´í…œì´ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒì„ ë°©ì§€ */
  flex-basis: calc(25% - 0.75rem); /* 4ê°œ ì•„ì´í…œê³¼ gapì„ ê³ ë ¤í•œ ë„ˆë¹„ */
  min-width: 110px; /* ìµœì†Œ ë„ˆë¹„ ì§€ì • */
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0.75rem 0.5rem;
  border-radius: 8px;
  background-color: #f8f9fa;
  box-sizing: border-box;
}

.info-value {
  font-weight: 600;
  font-size: 1.1rem;
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  border-radius: 0.75rem;
  max-width: 95vw;
  max-height: 95vh;
  width: 1200px;
  height: 95vh;
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
}

.modal-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 2rem;
  cursor: pointer;
  color: #6c757d;
  z-index: 1001;
  width: 3rem;
  height: 3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background-color 0.2s;
}

.flight-bookmark-panel {
  position: absolute;
            top: -36px; /* íŒ¨ë„ ë†’ì´ë§Œí¼ ìœ„ë¡œ ì´ë™ */
            right: 1.5rem; /* output-cardì˜ íŒ¨ë”©ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì • */
            width: 450px; /* ë„ˆë¹„ ê³ ì • */  z-index: 5; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ */
  background-color: var(--q-primary);
  border-radius: 8px 8px 0 0;
  box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
}


.modal-close:hover {
  background-color: #e3f2fd;
}

/* íŒ¨í‚¹ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹œì‘ ë²„íŠ¼ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
.packing-start-btn {
  border: 2px solid #2196f3 !important;
  box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2) !important;
  transition: all 0.3s ease !important;
}

.packing-start-btn:hover {
  transform: scale(1.05) !important;
  background-color: white !important;
  color: #2196f3 !important;
  border-color: #1976d2 !important;
  box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3) !important;
}

.packing-start-btn:active {
  transform: scale(1.02) !important;
}

/* Quasar ë²„íŠ¼ì˜ ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì œê±° */
.packing-start-btn::before,
.packing-start-btn::after {
  display: none !important;
}
</style>